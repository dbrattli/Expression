<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.3.dev5+gbec6307" />
<title>expression.system.cancellation API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>expression.system.cancellation</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from __future__ import annotations

from threading import RLock
from typing import Callable, Dict, Optional

from .disposable import Disposable
from .error import ObjectDisposedException


class CancellationToken:
    &#34;&#34;&#34;A `CancellationToken` enables cooperative cancellation between
    threads, thread pool work items, or Task objects. You create a
    cancellation token by instantiating a `CancellationTokenSource`
    object, which manages cancellation tokens retrieved from its
    CancellationTokenSource.Token property. You then pass the
    cancellation token to any number of threads, tasks, or operations
    that should receive notice of cancellation. The token cannot be used
    to initiate cancellation. When the owning object calls
    `CancellationTokenSource.cancel`, the `is_cancellation_requested`
    property on every copy of the cancellation token is set to true. The
    objects that receive the notification can respond in whatever manner
    is appropriate.&#34;&#34;&#34;

    def __init__(self, cancelled: bool = True, source: Optional[CancellationTokenSource] = None) -&gt; None:
        &#34;&#34;&#34;Should not be used directly. Create cancellation tokens using
        the `CancellationTokenSource` instead.&#34;&#34;&#34;

        self._cancelled = cancelled
        self._source = CancellationTokenSource.cancelled_source() if source is None else source

    @property
    def is_cancellation_requested(self) -&gt; bool:
        return not self._cancelled and self._source.is_cancellation_requested

    @property
    def can_be_canceled(self) -&gt; bool:
        return not self._cancelled

    def throw_if_cancellation_requested(self):
        if self.is_cancellation_requested:
            raise ObjectDisposedException()

    def register(self, callback: Callable[[], None]) -&gt; Disposable:
        return self._source.register_internal(callback)

    @staticmethod
    def none():
        return CancellationToken(True, None)


class CancellationTokenSource(Disposable):
    def __init__(self):
        self._is_disposed = False
        self._lock = RLock()
        self._listeners: Dict[int, Callable[[], None]] = dict()
        self._id = 0

    @property
    def token(self) -&gt; CancellationToken:
        return CancellationToken(False, self)

    @property
    def is_cancellation_requested(self) -&gt; bool:
        return self._is_disposed

    def cancel(self) -&gt; None:
        self.dispose()

    def dispose(self) -&gt; None:
        &#34;&#34;&#34;Performs the task of cleaning up resources.&#34;&#34;&#34;

        dispose = False
        with self._lock:
            if not self._is_disposed:
                dispose = True

        if dispose:
            self._is_disposed = True
            for listener in self._listeners.values():
                listener()

    def register_internal(self, callback: Callable[[], None]) -&gt; Disposable:
        if self._is_disposed:
            raise ObjectDisposedException()

        with self._lock:
            current = self._id
            self._listeners[current] = callback
            self._id += 1

        def dispose():
            with self._lock:
                del self._listeners[current]

        return Disposable.create(dispose)

    def __enter__(self) -&gt; CancellationToken:
        if self._is_disposed:
            raise ObjectDisposedException()
        return self.token

    @staticmethod
    def cancelled_source() -&gt; CancellationTokenSource:
        source = CancellationTokenSource()
        source.cancel()
        return source</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="expression.system.cancellation.CancellationToken"><code class="flex name class">
<span>class <span class="ident">CancellationToken</span></span>
<span>(</span><span>cancelled: bool = True, source: Optional[<a title="expression.system.cancellation.CancellationTokenSource" href="#expression.system.cancellation.CancellationTokenSource">CancellationTokenSource</a>] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>A <code><a title="expression.system.cancellation.CancellationToken" href="#expression.system.cancellation.CancellationToken">CancellationToken</a></code> enables cooperative cancellation between
threads, thread pool work items, or Task objects. You create a
cancellation token by instantiating a <code><a title="expression.system.cancellation.CancellationTokenSource" href="#expression.system.cancellation.CancellationTokenSource">CancellationTokenSource</a></code>
object, which manages cancellation tokens retrieved from its
CancellationTokenSource.Token property. You then pass the
cancellation token to any number of threads, tasks, or operations
that should receive notice of cancellation. The token cannot be used
to initiate cancellation. When the owning object calls
<code><a title="expression.system.cancellation.CancellationTokenSource.cancel" href="#expression.system.cancellation.CancellationTokenSource.cancel">CancellationTokenSource.cancel()</a></code>, the <code>is_cancellation_requested</code>
property on every copy of the cancellation token is set to true. The
objects that receive the notification can respond in whatever manner
is appropriate.</p>
<p>Should not be used directly. Create cancellation tokens using
the <code><a title="expression.system.cancellation.CancellationTokenSource" href="#expression.system.cancellation.CancellationTokenSource">CancellationTokenSource</a></code> instead.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CancellationToken:
    &#34;&#34;&#34;A `CancellationToken` enables cooperative cancellation between
    threads, thread pool work items, or Task objects. You create a
    cancellation token by instantiating a `CancellationTokenSource`
    object, which manages cancellation tokens retrieved from its
    CancellationTokenSource.Token property. You then pass the
    cancellation token to any number of threads, tasks, or operations
    that should receive notice of cancellation. The token cannot be used
    to initiate cancellation. When the owning object calls
    `CancellationTokenSource.cancel`, the `is_cancellation_requested`
    property on every copy of the cancellation token is set to true. The
    objects that receive the notification can respond in whatever manner
    is appropriate.&#34;&#34;&#34;

    def __init__(self, cancelled: bool = True, source: Optional[CancellationTokenSource] = None) -&gt; None:
        &#34;&#34;&#34;Should not be used directly. Create cancellation tokens using
        the `CancellationTokenSource` instead.&#34;&#34;&#34;

        self._cancelled = cancelled
        self._source = CancellationTokenSource.cancelled_source() if source is None else source

    @property
    def is_cancellation_requested(self) -&gt; bool:
        return not self._cancelled and self._source.is_cancellation_requested

    @property
    def can_be_canceled(self) -&gt; bool:
        return not self._cancelled

    def throw_if_cancellation_requested(self):
        if self.is_cancellation_requested:
            raise ObjectDisposedException()

    def register(self, callback: Callable[[], None]) -&gt; Disposable:
        return self._source.register_internal(callback)

    @staticmethod
    def none():
        return CancellationToken(True, None)</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="expression.system.cancellation.CancellationToken.none"><code class="name flex">
<span>def <span class="ident">none</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def none():
    return CancellationToken(True, None)</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="expression.system.cancellation.CancellationToken.can_be_canceled"><code class="name">var <span class="ident">can_be_canceled</span> : bool</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def can_be_canceled(self) -&gt; bool:
    return not self._cancelled</code></pre>
</details>
</dd>
<dt id="expression.system.cancellation.CancellationToken.is_cancellation_requested"><code class="name">var <span class="ident">is_cancellation_requested</span> : bool</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def is_cancellation_requested(self) -&gt; bool:
    return not self._cancelled and self._source.is_cancellation_requested</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="expression.system.cancellation.CancellationToken.register"><code class="name flex">
<span>def <span class="ident">register</span></span>(<span>self, callback: Callable[[], None]) ‑> <a title="expression.system.disposable.Disposable" href="disposable.html#expression.system.disposable.Disposable">Disposable</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def register(self, callback: Callable[[], None]) -&gt; Disposable:
    return self._source.register_internal(callback)</code></pre>
</details>
</dd>
<dt id="expression.system.cancellation.CancellationToken.throw_if_cancellation_requested"><code class="name flex">
<span>def <span class="ident">throw_if_cancellation_requested</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def throw_if_cancellation_requested(self):
    if self.is_cancellation_requested:
        raise ObjectDisposedException()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="expression.system.cancellation.CancellationTokenSource"><code class="flex name class">
<span>class <span class="ident">CancellationTokenSource</span></span>
</code></dt>
<dd>
<div class="desc"><p>A disposable class with a context manager. Must implement the
dispose method. Will dispose on exit.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CancellationTokenSource(Disposable):
    def __init__(self):
        self._is_disposed = False
        self._lock = RLock()
        self._listeners: Dict[int, Callable[[], None]] = dict()
        self._id = 0

    @property
    def token(self) -&gt; CancellationToken:
        return CancellationToken(False, self)

    @property
    def is_cancellation_requested(self) -&gt; bool:
        return self._is_disposed

    def cancel(self) -&gt; None:
        self.dispose()

    def dispose(self) -&gt; None:
        &#34;&#34;&#34;Performs the task of cleaning up resources.&#34;&#34;&#34;

        dispose = False
        with self._lock:
            if not self._is_disposed:
                dispose = True

        if dispose:
            self._is_disposed = True
            for listener in self._listeners.values():
                listener()

    def register_internal(self, callback: Callable[[], None]) -&gt; Disposable:
        if self._is_disposed:
            raise ObjectDisposedException()

        with self._lock:
            current = self._id
            self._listeners[current] = callback
            self._id += 1

        def dispose():
            with self._lock:
                del self._listeners[current]

        return Disposable.create(dispose)

    def __enter__(self) -&gt; CancellationToken:
        if self._is_disposed:
            raise ObjectDisposedException()
        return self.token

    @staticmethod
    def cancelled_source() -&gt; CancellationTokenSource:
        source = CancellationTokenSource()
        source.cancel()
        return source</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="expression.system.disposable.Disposable" href="disposable.html#expression.system.disposable.Disposable">Disposable</a></li>
<li>abc.ABC</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="expression.system.cancellation.CancellationTokenSource.cancelled_source"><code class="name flex">
<span>def <span class="ident">cancelled_source</span></span>(<span>) ‑> <a title="expression.system.cancellation.CancellationTokenSource" href="#expression.system.cancellation.CancellationTokenSource">CancellationTokenSource</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def cancelled_source() -&gt; CancellationTokenSource:
    source = CancellationTokenSource()
    source.cancel()
    return source</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="expression.system.cancellation.CancellationTokenSource.is_cancellation_requested"><code class="name">var <span class="ident">is_cancellation_requested</span> : bool</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def is_cancellation_requested(self) -&gt; bool:
    return self._is_disposed</code></pre>
</details>
</dd>
<dt id="expression.system.cancellation.CancellationTokenSource.token"><code class="name">var <span class="ident">token</span> : <a title="expression.system.cancellation.CancellationToken" href="#expression.system.cancellation.CancellationToken">CancellationToken</a></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def token(self) -&gt; CancellationToken:
    return CancellationToken(False, self)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="expression.system.cancellation.CancellationTokenSource.cancel"><code class="name flex">
<span>def <span class="ident">cancel</span></span>(<span>self) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel(self) -&gt; None:
    self.dispose()</code></pre>
</details>
</dd>
<dt id="expression.system.cancellation.CancellationTokenSource.dispose"><code class="name flex">
<span>def <span class="ident">dispose</span></span>(<span>self) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"><p>Performs the task of cleaning up resources.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dispose(self) -&gt; None:
    &#34;&#34;&#34;Performs the task of cleaning up resources.&#34;&#34;&#34;

    dispose = False
    with self._lock:
        if not self._is_disposed:
            dispose = True

    if dispose:
        self._is_disposed = True
        for listener in self._listeners.values():
            listener()</code></pre>
</details>
</dd>
<dt id="expression.system.cancellation.CancellationTokenSource.register_internal"><code class="name flex">
<span>def <span class="ident">register_internal</span></span>(<span>self, callback: Callable[[], None]) ‑> <a title="expression.system.disposable.Disposable" href="disposable.html#expression.system.disposable.Disposable">Disposable</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def register_internal(self, callback: Callable[[], None]) -&gt; Disposable:
    if self._is_disposed:
        raise ObjectDisposedException()

    with self._lock:
        current = self._id
        self._listeners[current] = callback
        self._id += 1

    def dispose():
        with self._lock:
            del self._listeners[current]

    return Disposable.create(dispose)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="expression.system.disposable.Disposable" href="disposable.html#expression.system.disposable.Disposable">Disposable</a></b></code>:
<ul class="hlist">
<li><code><a title="expression.system.disposable.Disposable.create" href="disposable.html#expression.system.disposable.Disposable.create">create</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="expression.system" href="index.html">expression.system</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="expression.system.cancellation.CancellationToken" href="#expression.system.cancellation.CancellationToken">CancellationToken</a></code></h4>
<ul class="">
<li><code><a title="expression.system.cancellation.CancellationToken.can_be_canceled" href="#expression.system.cancellation.CancellationToken.can_be_canceled">can_be_canceled</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationToken.is_cancellation_requested" href="#expression.system.cancellation.CancellationToken.is_cancellation_requested">is_cancellation_requested</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationToken.none" href="#expression.system.cancellation.CancellationToken.none">none</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationToken.register" href="#expression.system.cancellation.CancellationToken.register">register</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationToken.throw_if_cancellation_requested" href="#expression.system.cancellation.CancellationToken.throw_if_cancellation_requested">throw_if_cancellation_requested</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="expression.system.cancellation.CancellationTokenSource" href="#expression.system.cancellation.CancellationTokenSource">CancellationTokenSource</a></code></h4>
<ul class="">
<li><code><a title="expression.system.cancellation.CancellationTokenSource.cancel" href="#expression.system.cancellation.CancellationTokenSource.cancel">cancel</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationTokenSource.cancelled_source" href="#expression.system.cancellation.CancellationTokenSource.cancelled_source">cancelled_source</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationTokenSource.dispose" href="#expression.system.cancellation.CancellationTokenSource.dispose">dispose</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationTokenSource.is_cancellation_requested" href="#expression.system.cancellation.CancellationTokenSource.is_cancellation_requested">is_cancellation_requested</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationTokenSource.register_internal" href="#expression.system.cancellation.CancellationTokenSource.register_internal">register_internal</a></code></li>
<li><code><a title="expression.system.cancellation.CancellationTokenSource.token" href="#expression.system.cancellation.CancellationTokenSource.token">token</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.3.dev5+gbec6307</a>.</p>
</footer>
</body>
</html>